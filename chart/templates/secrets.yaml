{{- if and .Values.backblaze.enabled (not .Values.backblaze.existingSecret) }}
{{- if or .Values.backblaze.credentials.accessKeyId .Values.backblaze.credentials.secretAccessKey }}
# WARNING: It is recommended to use SealedSecrets instead of storing credentials in values
# See documentation for how to create and use SealedSecrets
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "longhorn-backup.fullname" . }}-b2-credentials
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "longhorn-backup.labels" . | nindent 4 }}
type: Opaque
stringData:
  AWS_ACCESS_KEY_ID: {{ .Values.backblaze.credentials.accessKeyId | quote }}
  AWS_SECRET_ACCESS_KEY: {{ .Values.backblaze.credentials.secretAccessKey | quote }}
{{- end }}
{{- end }}
---
{{- if and .Values.backblaze.enabled (not .Values.backblaze.encryption.existingSecret) }}
{{- if or .Values.backblaze.encryption.password .Values.backblaze.encryption.salt }}
# WARNING: It is recommended to use SealedSecrets instead of storing encryption keys in values
# The password and salt should be rclone-obscured values
# Generate with: rclone obscure <your-password>
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "longhorn-backup.fullname" . }}-b2-encryption
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "longhorn-backup.labels" . | nindent 4 }}
type: Opaque
stringData:
  password: {{ .Values.backblaze.encryption.password | quote }}
  salt: {{ .Values.backblaze.encryption.salt | quote }}
{{- end }}
{{- end }}
---
{{- if and .Values.notifications.enabled (not .Values.notifications.existingSecret) .Values.notifications.webhookUrl }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "longhorn-backup.fullname" . }}-webhook
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "longhorn-backup.labels" . | nindent 4 }}
type: Opaque
stringData:
  url: {{ .Values.notifications.webhookUrl | quote }}
{{- end }}
